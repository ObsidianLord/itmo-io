# Лабораторная работа 1

**Название:** "Разработка драйверов символьных устройств"

**Цель работы:** получить знания и навыки разработки драйверов символьных устройств для операционной системы Linux.

## Описание функциональности драйвера

Разработанный драйвер считает количество пробелов в тексте, который был введен в файл символьного устройства `/dev/var4`. Последовательность полученных результатов выводится в консоль пользователя и в кольцевой буфер ядра при чтении файла `/proc/var4` или файла символьного устройства `/dev/var4`.

## Инструкция по сборке

Драйвер собирается как модуль ядра Linux. Для сборки требуется перейти в директорию `lab1/` и выполнить команду `make`

Результат: в директории `lab1/` появился kernel object файл: `lab1.ko`

## Инструкция пользователя

Примечание: для выполнения практически всех команд требуются root права

Загрузка модуля в ядро, проверка загрузки:
```
# insomd lab1.ko
# lsmod | grep lab1
```
Ввод текста в файл символьного устройства:
```
# echo " test text " >/dev/var4
```
Вывод результатов:
```
# cat /proc/var4    # вывод в консоль пользователя
# cat /dev/var4     # вывод в консоль пользователя и в кольцевой буфер
```
Просмотр кольцевого буфера:
```
# dmesg
```
Выгрузка модуля:
```
# rmmod lab1.ko
```

## Примеры использования

```
# insomd lab1.ko          
# lsmod | grep lab1
lab1 <Size>  0
# dmesg
...
[ 3519.582977] lab1: initialization completed
# echo " test text " >/dev/var4     # 3 пробела
# cat /proc/var4
3
# echo " t est t ext " >/dev/var4   # 5 пробелов
# cat /dev/var4
3
8
# dmesg
...
[ 3791.282709] /dev/var4: open()
[ 3791.282752] /dev/var4: write() [space_ctr = 3, written_count = 2, size = 2, max_size = 16]
[ 3791.282758] /dev/var4: close()
[ 3799.968808] /proc/var4: read()
[ 3806.827775] /dev/var4: open()
[ 3806.827794] /dev/var4: write() [space_ctr = 8, written_count = 2, size = 4, max_size = 16]
[ 3806.827798] /dev/var4: close()
[ 3815.617270] /dev/var4: open()
[ 3815.617283] /dev/var4: read()
[ 3815.617284] /dev/var4: results:
               3
               8
[ 3815.617303] /dev/var4: close()
# rmmod lab1.ko
# dmesg
...
[ 3920.876607] lab1: resources freed 
```
